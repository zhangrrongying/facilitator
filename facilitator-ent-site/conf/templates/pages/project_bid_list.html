<!DOCTYPE html>
<head th:substituteby="/includes/header :: header" />
<div class="wrapper wrapper-content  animated fadeInRight">
    <div class="ibox ">
        <div class="ibox-content">
            <form id="searchForm" class="form-inline list-search" role="form">
                <div class="form-group">
                    <label>
                		项目名称
                		<input type="text" id="name" autofocus="autofocus" name="name" class="input-sm form-control" value="" />
                    </label>
                </div>
                <div class="form-group">
                    <label>
                		供应商
                		<input type="text" id="supplierName" name="supplierName" class="input-sm form-control" value="" />
                    </label>
                </div>
                <div class="form-group">
                    <label>项目类型<select id="projectTypeId" name="projectTypeId" class="chosen-select"></select>
                    </label>
                </div>
            </form>
            <div class="list-btn">
                <button id="search" class="btn btn-primary btn-sm" >
                    搜 索 <i class="fa fa-search"></i>
                </button>
                <button id="search-reset" class="btn btn-primary btn-sm" >
                    显示所有
                </button>
                <button th:if="${hasAddBtn} == true" id="add" class="btn btn-danger btn-sm" onclick="bid()">
                    招标<i class="fa fa-plus"></i>
                </button>
            </div>
            <div class="jqGrid_wrapper">
                <table id="table_list_1"></table>
                <div id="pager_list_1"></div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="bidModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">项目招标</h4>
            </div>
            <div class="modal-body ">
                <form id="bidform" class="form-horizontal">
                    <input name="id" style="display: none;" />
                    <div class="form-group">
				        <label class="col-md-2 control-label">项目名称</label>
				        <div class="col-md-9">
				            <select id="projectId" name="projectId" class="chosen-select"></select>
				        </div>
				    </div>
				    <div class="form-group">
				        <label class="col-md-2 control-label">招标方式</label>
				        <div class="col-md-9">
				            <select id="bidType" name="bidType" class="chosen-select"></select>
				        </div>
				    </div>
                </form>
            </div>
            <div class="modal-footer">
                <div class="">
                    <img id="cover1" src="/images/loading1.gif" style="align-content:center;display: none;" />
                    <button id="submit1" type="button" class="btn btn-primary">招标</button>
                    <button type="button" class="btn btn-white btn-close" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" th:inline="text">
	//<![CDATA[
        var jsonCondition = {};
        $(function () {
            syk.initList();
            loadProjectType(); 
            window.setTimeout(function() {
            	var dataGrid = new DataGrid({
                	 url:'/project/bid/list.json',
                	 dataGridTable: $("#table_list_1"),
                     pagerId : '#pager_list_1',
                	 colNames : ['ID','项目名称','项目类型','投资规模','中标供应商','状态','中标时间','操作'],
                     colModel : [
                                {name:'id', index:'id', width:100,align:"center",sortable:false},
                                {name:'name', index:'name', width:250,align:"center",sortable:false,classes:'text'},
                                {name:'projectTypeName', index:'projectTypeName',align:"center", width:200,sortable:false},
                                {name:'investment', index:'investment', width:150,align:"center",sortable:false},
                                {name:'supplierName', index:'description', width:250,align:"center",sortable:false,classes:'text'},
                                {name:'status', index:'status',align:"center", width:150,formatter: formatStatus,sortable:false},
                                {name:'createTime', index:'createTime',align:"center", width:150,formatter: syk.formatTime,sortable:false,classes:'text'},
                                {name:'operate', index:'operate', width:150,align:"center",formatter: formatMenu,sortable:false},
                              ]
                });
    		},100);
    		loadProject();
	        loadBidType();
        });
     
    	function loadProject(){
        	syk.get("/project/bid.json", function (datas) {
	        	syk.initFixedChosen(datas, { selector: $("#projectId") });
	        });
        }
        
        function loadBidType(){
        	var data = [{"id":"1","name":"随机选择"},{"id":"2","name":"限定选择"},{"id":"3","name":"条件选择"}];
	        syk.initFixedChosen(data, { selector: $("#bidType") });
        }
        
        function formatMenu(cellvalue, options, rowObject) {
        	var btns = '<div class="btn-group"><button data-toggle="dropdown" class="btn btn-primary btn-xs dropdown-toggle">操作<span class="caret"></span></button>' +
      		'<ul class="dropdown-menu">';
      		if ([[${hasEditBtn}]] == true) {
	           btns = btns + '<li><a href="#" onclick="edit(' + rowObject.id + ');">评分</a></li>';
	        }
        	btns = btns + '<li><a href="#" onclick="look(' + rowObject.id + ');">查看</a></li>';
			return btns + '</ul></div>';
		}
		
		function formatStatus(cellvalue, options, rowObject) {
        	if(cellvalue == 2){
        		return '中标';
        	}else if(cellvalue == 3){
        		return '完成';
        	}else if(cellvalue == 4){
        		return '已评分';
        	}
		}

        function loadProjectType() {
	    	syk.get("/project/type.json", function (datas) {
	        	syk.initFixedChosen(datas, { selector: $("#projectTypeId") });
	        });
	    }
	    
	    //function bid() {
	        //syk.parent.sykModal.open({ url: "/pages/project/bid", title: "项目招标", top: '10%', ftitle: '', size: 500 });
	    //}
	    function bid() {
	   		$("#bidform")[0].reset();
	   		loadProject();
	        loadBidType();
	        $('#bidModal').modal('show').css({ "margin-top": "-70px" });
	    }
    //]]>
</script>
